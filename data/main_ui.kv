#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import IconLeftWidget kivymd.uix.list.IconLeftWidget
#:import images_path kivymd.images_path
#:include 'data/navbar.kv'

MyScreenManager:
    id: screenmanage
    transition: NoTransition()
    HomeScreen:
        id: home

<NavigationItem>:
    theme_text_color: 'Primary'
    divider: None

    IconLeftWidget:
        icon: root.icon


<Gauge>:
    on_size: self.recalculate_lines()
    on_pos: self.recalculate_lines()
    on_fill_fraction: self.recalculate_lines()
    canvas:
        Color:
            rgba: 0.016, 0.141, 0.141, 1
        Line:
            points: self.line_points
            width: self.height * 0.03
        Color:
            rgba: 0.768, 0.039, 0, 1
        Line:
            points: self.filled_in_points
            width: self.height * 0.03

<GaugeSmall>:
    on_size: self.recalculate_lines()
    on_pos: self.recalculate_lines()
    on_fill_fraction: self.recalculate_lines()
    canvas:
        Color:
            rgba: 0.016, 0.141, 0.141, 1
        Line:
            points: self.line_points
            width: self.height * 0.03
        Color:
            rgba: 0.768, 0.039, 0, 1
        Line:
            points: self.filled_in_points
            width: self.height * 0.03


 
<HomeScreen>:
    name: 'hometest'
    id: home
  
        
    FloatLayout:
        MDBottomNavigation:
            id: panel
            panel_color: [0.2980392156862745, 0.2823529411764706, 0.32941176470588235, 1] 

            
        
       

            MDBottomNavigationItem:
                name: "home"
                text: "Home"
                icon: "home-circle"
                
                FloatLayout: 
                    GridLayout:   
                        cols: 4    
                        row_force_default:True
                        row_default_height:150
                        col_default_width:150
                        col_force_default:True
                        spacing: 40, 40
                        pos_hint: {'center_x': 0.11, 'center_y': .81}
                        size_hint: (None, None)
                        size_hint_y: None
                        #performance app
                        Button:
                            id: performance-app-dashboard
                            background_color:(0.9, 0.9, 0.9, 0.0)
                            text: "\n\n\n\n\n\n\nPerformance"
                            font_size: 18
                            on_release:
                                performance_2.dispatch("on_tab_press")
                
                            
                                
                            Image:
                                source: 'data/icons/performance_app.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                size: 120, 120
                                allow_stretch: True

                        Button:
                            id: maintenance-app-dashboard
                            background_color:(0.9, 0.9, 0.9, 0.0)
                            text: "\n\n\n\n\n\n\nMaintainence"
                            font_size: 18
                            on_release:   
                                app.basic_popup("Feature Not Available", "This feature will be released in later builds", "Ok", lambda x: app.close_current_popup())
                            Image:
                                source: 'data/icons/maintenance_app.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                size: 120, 120
                                allow_stretch: True
                        Button:
                            id: garage-app-dashboard
                            background_color:(0.9, 0.9, 0.9, 0.0)
                            text: "\n\n\n\n\n\n\nMy Garage"
                            font_size: 18
                            on_release:   
                                app.basic_popup("Feature Not Available", "This feature will be released in later builds", "Ok", lambda x: app.close_current_popup())
                            Image:
                                source: 'data/icons/garage_app.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                size: 120, 120
                                allow_stretch: True
                        #settings app
                        Button:
                            id: settings-app-dashboard
                            background_color:(0.9, 0.9, 0.9, 0.0)
                            text: "\n\n\n\n\n\n\nSettings"
                            font_size: 18
                            on_release:   
                                app.open_settings()
                            Image:
                                source: 'data/icons/settings_app.png'
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                                size: 120, 120
                                allow_stretch: True


            

                    
                                   
                
               
                

            MDBottomNavigationItem:
                name: "performance"
                id: performance_2
                text: "Performance"
                icon: "engine"
                on_enter:
                    app.enable_obd_ui_updates()
                on_leave:
                    app.disable_obd_ui_updates()
             

                RelativeLayout:
                    GaugeSmall:
                        fill_fraction: app.mafOBDValue
                        pos_hint: {'center_x': 0.9, 'center_y': 0.77}
                        size_hint: 0.3, 0.3
                    Label:
                        text: app.mafOBD
                        pos_hint: {'center_x': 0.9, 'center_y': 0.77}
                        font_size: dp(20)
                    Label:
                        text: "MAF"
                        pos_hint: {'center_x': 0.9, 'center_y': 0.61}
                        

                #Timing Advance
                RelativeLayout:
                    GaugeSmall:
                        fill_fraction: app.timingAdvanceOBDValue
                        pos_hint: {'center_x': 0.7, 'center_y': 0.77}
                        size_hint: 0.3, 0.3
                    Label:
                        text: app.timingAdvanceOBD
                        pos_hint: {'center_x': 0.7, 'center_y': 0.77}
                        font_size: dp(20)
                    Label:
                        text: "Timing"
                        pos_hint: {'center_x': 0.7, 'center_y': 0.61}
                        font_size: dp(15)
                
                #Throttle
                RelativeLayout:
                    GaugeSmall:
                        fill_fraction: app.throttlePositionOBDValue
                        pos_hint: {'center_x': 0.5, 'center_y': 0.77}
                        size_hint: 0.3, 0.3
                    Label:
                        text: app.throttlePositionOBD
                        pos_hint: {'center_x': 0.5, 'center_y': 0.77}
                        font_size: dp(20)
                    Label:
                        text: "Throttle"
                        pos_hint: {'center_x': 0.5, 'center_y': 0.61}
                        font_size: dp(15)

                    #Air Intake
                    RelativeLayout:
                        GaugeSmall:
                            fill_fraction: app.intakePressureOBDValue
                            pos_hint: {'center_x': 0.3, 'center_y': 0.77}
                            size_hint: 0.3, 0.3
                        Label:
                            text: app.intakePressureOBD
                            pos_hint: {'center_x': 0.3, 'center_y': 0.77}
                            font_size: dp(20)
                        Label:
                            text: "Air Intake"
                            pos_hint: {'center_x': 0.3, 'center_y': 0.61}
                            font_size: dp(15)

                    #Coolant Temperature
                    RelativeLayout:
                        GaugeSmall:
                            fill_fraction: app.coolantTemperatureOBDValue
                            pos_hint: {'center_x': 0.1, 'center_y': 0.77}
                            size_hint: 0.3, 0.3
                        Label:
                            text: app.coolantTemperatureOBD
                            pos_hint: {'center_x': 0.1, 'center_y': 0.77}
                            font_size: dp(20)
                        Label:
                            text: "Coolant \N{DEGREE SIGN}C"
                            pos_hint: {'center_x': 0.1, 'center_y': 0.61}
                            font_size: dp(15)
                    
                #RPM Gauge
                RelativeLayout:
                    Gauge:
                        fill_fraction: app.rpmOBDValue
                        pos_hint: {'center_x': 0.5, 'center_y': 0.29}
                        size_hint: 0.5, 0.5
                    Label:
                        text: app.rpmOBD
                        pos_hint: {'center_x': 0.5, 'center_y': 0.29}
                        font_size: dp(60)
                    Label:
                        text: "RPM"
                        pos_hint: {'center_x': 0.5, 'center_y': 0.14}
                        font_size: dp(20)

                #Speed
                Label:
                    text: "MPH"
                    pos_hint: {'center_x': 0.2, 'center_y': 0.4}
                    font_size: dp(20)
                Label:
                    text: app.speedOBD
                    pos_hint: {'center_x': 0.2, 'center_y': 0.25}
                    font_size: dp(60)
                    
                #GEAR
                Label:
                    text: "GEAR"
                    pos_hint: {'center_x': 0.8, 'center_y': 0.4}
                    font_size: dp(20)
                Label:
                    text: app.gear
                    pos_hint: {'center_x': 0.8, 'center_y': 0.25}
                    font_size: dp(60)
            
            MDBottomNavigationItem:
                name: "settings"
                id: settings
                text: "Settings"
                icon: "settings-box"

                NavigationLayout:

                    ScreenManager:
                        id: settings_sm
                        transition: NoTransition()

                        Screen:
                            name: "general_settings_screen"
                            AnchorLayout:
                                anchor_x: 'center'
                                anchor_y: 'top'
                                MDToolbar:
                                    title: "Settings"
                                    md_bg_color: app.theme_cls.primary_color
                                    elevation: 5
                                    left_action_items: [['menu', lambda x: settings_panel.toggle_nav_drawer()]]
                                
                                FloatLayout:
                                    Button:
                                        text: "Temporary Settings"
                                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                        size_hint: .2,.2
                                        on_press:
                                            app.show_example_input_dialog()

                        Screen:
                            name: "obd_settings_screen"
                            AnchorLayout:
                                anchor_x: 'center'
                                anchor_y: 'top'
                                MDToolbar:
                                    title: "Settings > OBD"
                                    md_bg_color: app.theme_cls.primary_color
                                    elevation: 5
                                    left_action_items: [['menu', lambda x: settings_panel.toggle_nav_drawer()]]
                                
                                FloatLayout:
                                    Button:
                                        text: "OBD"
                                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                        size_hint: .2,.2
                                        on_press:
                                            root.ids.settings_sm.current = 'obd_settings_screen'
                                                  
                    MDNavigationDrawer:
                        id: settings_panel
                        
                        BoxLayout:
                            orientation: 'vertical'

                          
                            FloatLayout:
                                size_hint_y: None
                                height: "60dp"

                            MDIconButton:
                                icon: "close"
                                x: root.parent.x + dp(10)
                                pos_hint: {"top": .8}
                                on_release: settings_panel.toggle_nav_drawer()


                            ScrollView:
                                pos_hint: {"top": 1}

                                GridLayout:
                                    id: box_item
                                    cols: 1
                                    size_hint_y: None
                                    height: self.minimum_height
                                    NavigationItem:
                                        icon: 'tune'
                                        id: general_settings
                                        text: "General"
                                        on_press:
                                            root.ids.settings_sm.current = 'general_settings_screen'
                                            settings_panel.toggle_nav_drawer()
                                    NavigationItem:
                                        icon: 'router-wireless'
                                        id: obd_settings
                                        text: "OBD"
                                        on_press:
                                            root.ids.settings_sm.current = 'obd_settings_screen'
                                            settings_panel.toggle_nav_drawer()
                                    NavigationItem:
                                        icon: 'car-estate'
                                        id: obd_settings
                                        text: "Vehicle"
           
                    
                                        
        
                                    

                              
    
                               
                        
                                

            
      

       
           

      
 

         